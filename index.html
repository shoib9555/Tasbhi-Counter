<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SHOIB'S Tasbih Counter</title>
  <style>
    :root {
      --bg: #0f172a;         /* slate-900 */
      --card: #111827;       /* gray-900 */
      --muted: #94a3b8;      /* slate-400 */
      --text: #e5e7eb;       /* gray-200 */
      --accent: #22c55e;     /* green-500 */
      --accent-2: #06b6d4;   /* cyan-500 */
      --danger: #ef4444;     /* red-500 */
      --ring: rgba(34, 197, 94, 0.3);
    }
    .light {
      --bg: #f8fafc;         /* slate-50 */
      --card: #ffffff;       /* white */
      --muted: #475569;      /* slate-600 */
      --text: #0f172a;       /* slate-900 */
      --accent: #22c55e;     /* green-500 */
      --accent-2: #0ea5e9;   /* sky-500 */
      --danger: #dc2626;     /* red-600 */
      --ring: rgba(14, 165, 233, 0.25);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI,
      Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji",
      "Segoe UI Emoji";
      background: radial-gradient(1200px 1200px at 80% -20%, rgba(34,197,94,0.08), transparent 60%),
                  radial-gradient(1200px 1200px at -10% 120%, rgba(14,165,233,0.08), transparent 60%),
                  var(--bg);
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    .wrap { min-height: 100%; display: grid; place-items: center; padding: 24px; }

    .card {
      width: min(680px, 96vw);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)) , var(--card);
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.04);
      backdrop-filter: blur(6px);
    }

    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    header h1 { font-size: clamp(18px, 3.2vw, 22px); margin: 0; letter-spacing: 0.2px; }
    header .actions { display: flex; gap: 8px; flex-wrap: wrap; }

    button, .icon-btn {
      appearance: none; border: 1px solid rgba(148,163,184,0.25);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.08));
      color: var(--text);
      padding: 10px 14px; border-radius: 12px; cursor: pointer;
      font-weight: 600; letter-spacing: 0.2px;
      transition: transform .06s ease, box-shadow .15s ease, border-color .2s ease;
      box-shadow: 0 2px 0 rgba(0,0,0,0.25);
    }
    button:active, .icon-btn:active { transform: translateY(1px) scale(0.99); }
    button:focus-visible, .icon-btn:focus-visible { outline: 2px solid var(--ring); outline-offset: 2px; }

    .primary { border-color: rgba(34,197,94,0.35); box-shadow: 0 4px 0 rgba(34,197,94,0.25); }
    .danger { border-color: rgba(239,68,68,0.35); box-shadow: 0 4px 0 rgba(239,68,68,0.25); }

    .panel { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 18px; }

    .display {
      display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: center;
      padding: 14px; border-radius: 16px; border: 1px dashed rgba(148,163,184,0.35);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    }

    .count { font-size: clamp(42px, 12vw, 84px); font-weight: 800; line-height: 1; }
    .sub { color: var(--muted); font-size: 12px; }
    .goal { display: flex; align-items: center; gap: 8px; font-size: 14px; }

    .ring { width: 120px; height: 120px; position: relative; }
    .ring svg { transform: rotate(-90deg); display: block; overflow: visible; }
    .ring .label { position: absolute; inset: 0; display: grid; place-items: center; font-weight: 700; }

    .big {
      display: grid; place-items: center; height: 220px; border-radius: 32px;
      background: radial-gradient(200px 140px at 50% 30%, rgba(34,197,94,0.18), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.1));
      border: 1px solid rgba(34,197,94,0.35);
      box-shadow: 0 12px 0 rgba(34,197,94,0.20), 0 18px 36px rgba(0,0,0,0.35);
      font-size: 28px; font-weight: 800; letter-spacing: .5px;
      cursor: pointer;
      transition: transform .06s ease;
      -webkit-user-select: none; user-select: none;
    }
    .big:active { transform: translateY(2px) scale(0.995); }

    .controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }

    .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .row input[type="number"] {
      width: 120px; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(148,163,184,0.35);
      background: transparent; color: var(--text); font-weight: 600;
    }
    .toggle { display: inline-flex; align-items: center; gap: 8px; font-size: 13px; color: var(--muted); }
    .link { color: var(--accent-2); text-decoration: none; font-weight: 700; }

    footer { margin-top: 16px; text-align: center; color: var(--muted); font-size: 12px; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; background: rgba(148,163,184,0.2); padding: 2px 6px; border-radius: 6px; }

    @media (max-width: 520px) {
      .controls { grid-template-columns: repeat(2, 1fr); }
      .ring { display: none; }
      header .actions { width: 100%; justify-content: flex-end; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <h1>ðŸŸ¢ Tasbih Counter</h1>
        <div class="actions">
          <button id="themeBtn" class="icon-btn" title="Toggle theme">Toggle theme</button>
          <button id="resetBtn" class="icon-btn danger" title="Reset (R)">Reset</button>
        </div>
      </header>

      <section class="panel">
        <div class="display">
          <div>
            <div class="count" id="count">0</div>
            <div class="sub" id="status">Tap the big button or press <span class="kbd">Space</span>/<span class="kbd">Enter</span> to count.</div>
            <div class="goal" style="margin-top:10px;">
              <span>Goal:</span>
              <strong id="goalText">â€”</strong>
              <button id="setGoalBtn">Set goal</button>
              <button id="clearGoalBtn">Clear goal</button>
            </div>
          </div>

          <div class="ring" aria-hidden="true">
            <svg width="120" height="120">
              <defs>
                <filter id="glow"><feGaussianBlur stdDeviation="2.2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
              </defs>
              <circle cx="60" cy="60" r="52" stroke="rgba(148,163,184,0.25)" stroke-width="10" fill="none"/>
              <circle id="progress" cx="60" cy="60" r="52" stroke="var(--accent)" stroke-width="10" stroke-linecap="round" fill="none" stroke-dasharray="327" stroke-dashoffset="327" filter="url(#glow)"/>
            </svg>
            <div class="label" id="progressLabel">0%</div>
          </div>
        </div>

        <button id="bigBtn" class="big primary" aria-label="Increment">TAP +1</button>

        <div class="controls">
          <button id="minusBtn">âˆ’1</button>
          <button id="add10Btn">+10</button>
          <button id="add33Btn">+33</button>
          <button id="add99Btn">+99</button>
        </div>

        <div class="row">
          <label class="toggle"><input type="checkbox" id="vibrateChk" checked> Haptics</label>
          <label class="toggle"><input type="checkbox" id="soundChk"> Click sound</label>
          <label class="toggle"><input type="checkbox" id="wrapChk"> Auto-wrap at goal</label>
          <label class="toggle"><input type="checkbox" id="beadsChk"> Show tasbih cycles (33)</label>
        </div>

        <div class="row" id="beadsRow" style="display:none;">
          <span class="sub">Cycle (33s): <strong id="cycleText">0 / 1</strong></span>
        </div>

        <div class="row">
          <input type="number" id="customStep" placeholder="Custom step (e.g. 5)" min="1" />
          <button id="customStepBtn">Add step</button>
        </div>

      </section>

      <footer>
        Shortcuts: <span class="kbd">Space/Enter</span> +1, <span class="kbd">Backspace</span> âˆ’1, <span class="kbd">R</span> reset, <span class="kbd">G</span> set goal.
      </footer>
    </div>
  </div>

  <audio id="clickAudio">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA" type="audio/mp3">
  </audio>

  <script>
    (function() {
      const $ = (id) => document.getElementById(id);
      const countEl = $("count");
      const statusEl = $("status");
      const bigBtn = $("bigBtn");
      const minusBtn = $("minusBtn");
      const resetBtn = $("resetBtn");
      const add10Btn = $("add10Btn");
      const add33Btn = $("add33Btn");
      const add99Btn = $("add99Btn");
      const customStep = $("customStep");
      const customStepBtn = $("customStepBtn");
      const setGoalBtn = $("setGoalBtn");
      const clearGoalBtn = $("clearGoalBtn");
      const goalText = $("goalText");
      const progress = $("progress");
      const progressLabel = $("progressLabel");
      const vibrateChk = $("vibrateChk");
      const soundChk = $("soundChk");
      const wrapChk = $("wrapChk");
      const beadsChk = $("beadsChk");
      const beadsRow = $("beadsRow");
      const cycleText = $("cycleText");
      const themeBtn = $("themeBtn");
      const audio = $("clickAudio");

      const DASH = 2 * Math.PI * 52; // circumference

      const state = {
        count: 0,
        goal: null,
        theme: localStorage.getItem('tasbih-theme') || 'dark',
        haptics: JSON.parse(localStorage.getItem('tasbih-haptics') || 'true'),
        sound: JSON.parse(localStorage.getItem('tasbih-sound') || 'false'),
        wrap: JSON.parse(localStorage.getItem('tasbih-wrap') || 'false'),
        beads: JSON.parse(localStorage.getItem('tasbih-beads') || 'false')
      };

      function save() {
        localStorage.setItem('tasbih-count', String(state.count));
        localStorage.setItem('tasbih-goal', state.goal == null ? '' : String(state.goal));
        localStorage.setItem('tasbih-theme', state.theme);
        localStorage.setItem('tasbih-haptics', JSON.stringify(state.haptics));
        localStorage.setItem('tasbih-sound', JSON.stringify(state.sound));
        localStorage.setItem('tasbih-wrap', JSON.stringify(state.wrap));
        localStorage.setItem('tasbih-beads', JSON.stringify(state.beads));
      }
      function load() {
        state.count = parseInt(localStorage.getItem('tasbih-count') || '0', 10) || 0;
        const g = localStorage.getItem('tasbih-goal');
        state.goal = g ? (parseInt(g, 10) || null) : null;
      }

      function applyTheme() {
        if (state.theme === 'light') document.body.classList.add('light');
        else document.body.classList.remove('light');
      }

      function updateUI() {
        countEl.textContent = state.count;
        goalText.textContent = state.goal != null ? state.goal : 'â€”';
        const pct = state.goal ? Math.min(100, Math.round((state.count / state.goal) * 100)) : 0;
        const offset = DASH - (DASH * pct) / 100;
        progress.style.strokeDasharray = DASH;
        progress.style.strokeDashoffset = String(isFinite(offset) ? offset : DASH);
        progressLabel.textContent = (state.goal ? pct : 0) + '%';
        // tasbih cycles of 33
        if (state.beads) {
          const cycle = Math.floor(state.count / 33) + 1;
          const within = state.count % 33;
          cycleText.textContent = `${within} / ${cycle}`;
          beadsRow.style.display = '';
        } else {
          beadsRow.style.display = 'none';
        }
      }

      function bump(n = 1) {
        const prev = state.count;
        let next = prev + n;
        if (state.goal && state.wrap && next >= state.goal) {
          next = next % state.goal; // wrap-around
        }
        state.count = Math.max(0, next);
        feedback(n > 0 ? 'inc' : 'dec');
        save();
        updateUI();
      }

      function feedback(kind) {
        if (state.haptics && 'vibrate' in navigator) {
          navigator.vibrate(kind === 'inc' ? 10 : 6);
        }
        if (state.sound) {
          try { audio.currentTime = 0; audio.play().catch(()=>{}); } catch {}
        }
      }

      function reset() {
        if (confirm('Reset the counter to 0?')) {
          state.count = 0; save(); updateUI();
        }
      }

      function setGoal() {
        const input = prompt('Set a goal (number, e.g. 33, 99, 100):', state.goal ?? '');
        if (input === null) return;
        const g = parseInt(input, 10);
        if (!isNaN(g) && g > 0) { state.goal = g; save(); updateUI(); }
        else alert('Please enter a valid positive number.');
      }

      function clearGoal() {
        state.goal = null; save(); updateUI();
      }

      // Events
      bigBtn.addEventListener('click', () => bump(1));
      minusBtn.addEventListener('click', () => bump(-1));
      add10Btn.addEventListener('click', () => bump(10));
      add33Btn.addEventListener('click', () => bump(33));
      add99Btn.addEventListener('click', () => bump(99));
      resetBtn.addEventListener('click', reset);
      setGoalBtn.addEventListener('click', setGoal);
      clearGoalBtn.addEventListener('click', clearGoal);

      customStepBtn.addEventListener('click', () => {
        const v = parseInt(customStep.value, 10);
        if (!isNaN(v) && v > 0) bump(v);
        else alert('Enter a positive number.');
      });

      vibrateChk.addEventListener('change', e => { state.haptics = e.target.checked; save(); });
      soundChk.addEventListener('change', e => { state.sound = e.target.checked; save(); });
      wrapChk.addEventListener('change', e => { state.wrap = e.target.checked; save(); });
      beadsChk.addEventListener('change', e => { state.beads = e.target.checked; save(); updateUI(); });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;
        if (e.code === 'Space' || e.key === 'Enter') { e.preventDefault(); bump(1); }
        else if (e.key === 'Backspace') { e.preventDefault(); bump(-1); }
        else if (e.key.toLowerCase() === 'r') { reset(); }
        else if (e.key.toLowerCase() === 'g') { setGoal(); }
      }, { passive: false });

      // Theme
      themeBtn.addEventListener('click', () => {
        state.theme = state.theme === 'light' ? 'dark' : 'light';
        applyTheme(); save();
      });

      // Init
      load();
      applyTheme();
      vibrateChk.checked = state.haptics;
      soundChk.checked = state.sound;
      wrapChk.checked = state.wrap;
      beadsChk.checked = state.beads;
      updateUI();

      // Make whole card tappable for +1 on mobile long press prevention
      let pressTimer;
      bigBtn.addEventListener('touchstart', () => { pressTimer = setInterval(() => bump(1), 260); }, { passive: true });
      bigBtn.addEventListener('touchend', () => { clearInterval(pressTimer); }, { passive: true });
    })();
  </script>
</body>
</html>
